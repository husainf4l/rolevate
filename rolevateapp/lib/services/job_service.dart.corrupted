import 'package:flutter/foundation.dart';
import 'package:graphql_flutter/graphql_flutter.dart';
import 'package:get_storage/get_storage.dart';
import 'package:rolevateapp/models/models.dart';
import 'package:rolevateapp/services/graphql_service.dart';

class JobService {
  JobService();
  
  // Use GetStorage for persistent mock jobs
  final _storage = GetStorage();
  static const String _mockJobsKey = 'mock_created_jobs';
  
  // Get mock created jobs from storage
  List<Map<String, dynamic>> get _mockCreatedJobs {
    final stored = _storage.read<List>(_mockJobsKey);
    if (stored == null) return [];
    return stored.map((e) => Map<String, dynamic>.from(e as Map)).toList();
  }
  
  // Save mock created jobs to storage
  void _saveMockJobs(List<Map<String, dynamic>> jobs) {
    _storage.write(_mockJobsKey, jobs);
  }

  /// Fetch jobs with optional filters and pagination
  Future<List<Job>> getJobs({
    JobType? type,
    JobLevel? jobLevel,
    WorkType? workType,
    JobStatus? status,
    String? industry,
    String? location,
    String? department,
    String? companyId,
    bool? featured,
    int? limit,
    int? page,
  }) async {
    debugPrint('üîß JobService.getJobs called');

    // REAL BACKEND - GraphQL API
    const String query = '''
      query GetJobs(\$filter: JobFilterInput, \$pagination: PaginationInput) {
        jobs(filter: \$filter, pagination: \$pagination) {
          id
          slug
          title
          department
          location
          salary
          type
          jobLevel
          workType
          status
          shortDescription
          applicants
          views
          featured
          deadline
          createdAt
          updatedAt
          company {
            id
            name
            logo
            industry
            size
            location
          }
          postedBy {
            id
            name
            avatar
          }
        }
      }
    ''';

    final variables = {
      'filter': {
        if (type != null) 'type': type.toJson(),
        if (jobLevel != null) 'jobLevel': jobLevel.toJson(),
        if (workType != null) 'workType': workType.toJson(),
        if (status != null) 'status': status.toJson(),
        if (industry != null) 'industry': industry,
        if (location != null) 'location': location,
        if (department != null) 'department': department,
        if (companyId != null) 'companyId': companyId,
        if (featured != null) 'featured': featured,
      },
      'pagination': {
        if (limit != null) 'limit': limit,
        if (page != null) 'page': page,
      },
    };

    final result = await GraphQLService.client.query(
      QueryOptions(
        document: gql(query),
        variables: variables,
        fetchPolicy: FetchPolicy.networkOnly,
      ),
    );

    if (result.hasException) {
      debugPrint('‚ùå GraphQL Exception in getJobs: ${result.exception.toString()}');

      // Extract more specific error information
      if (result.exception?.graphqlErrors.isNotEmpty ?? false) {
        for (var error in result.exception!.graphqlErrors) {
          debugPrint('  - GraphQL Error: ${error.message}');
          debugPrint('  - Extensions: ${error.extensions}');
        }
      }

      if (result.exception?.linkException != null) {
        debugPrint('  - Link Exception: ${result.exception!.linkException}');
      }

      throw Exception(result.exception.toString());
    }

    final List<dynamic> jobsData = result.data?['jobs'] ?? [];
    debugPrint('‚úÖ Fetched ${jobsData.length} jobs from backend');
    return jobsData.map((json) => Job.fromJson(json)).toList();
  }

  /// Get a single job by ID
  Future<Job?> getJob(String id) async {
        'title': 'Senior Software Engineer',
        'department': 'Engineering',
        'location': 'Dubai, UAE',
        'salary': 'AED 25,000 - 35,000',
        'type': 'FULL_TIME',
        'jobLevel': 'SENIOR',
        'workType': 'ONSITE',
        'status': 'ACTIVE',
        'shortDescription': 'We are looking for a Senior Software Engineer to join our team.',
        'applicants': 12.0,
        'views': 156.0,
        'featured': true,
        'deadline': DateTime.now().add(const Duration(days: 14)).toIso8601String(),
        'createdAt': DateTime.now().subtract(const Duration(days: 2)).toIso8601String(),
        'updatedAt': DateTime.now().subtract(const Duration(days: 1)).toIso8601String(),
        'company': {
          'id': 'mock-company-1',
          'name': 'TechCorp Solutions',
          'logo': null,
          'industry': 'Technology',
          'size': '201-500',
          'location': 'Dubai, UAE',
        },
        'postedBy': {
          'id': 'mock-user-1',
          'name': 'John Smith',
          'avatar': null,
        },
      },
      {
        'id': 'mock-job-2',
        'slug': 'product-manager',
        'title': 'Product Manager',
        'department': 'Product',
        'location': 'Abu Dhabi, UAE',
        'salary': 'AED 20,000 - 30,000',
        'type': 'FULL_TIME',
        'jobLevel': 'MID',
        'workType': 'HYBRID',
        'status': 'ACTIVE',
        'shortDescription': 'Join our product team to drive innovation and user experience.',
        'applicants': 8.0,
        'views': 89.0,
        'featured': false,
        'deadline': DateTime.now().add(const Duration(days: 21)).toIso8601String(),
        'createdAt': DateTime.now().subtract(const Duration(days: 5)).toIso8601String(),
        'updatedAt': DateTime.now().subtract(const Duration(days: 3)).toIso8601String(),
        'company': {
          'id': 'mock-company-2',
          'name': 'InnovateLabs',
          'logo': null,
          'industry': 'Technology',
          'size': '51-200',
          'location': 'Abu Dhabi, UAE',
        },
        'postedBy': {
          'id': 'mock-user-2',
          'name': 'Sarah Johnson',
          'avatar': null,
        },
      },
      {
        'id': 'mock-job-3',
        'slug': 'ux-designer',
        'title': 'UX Designer',
        'department': 'Design',
        'location': 'Dubai, UAE',
        'salary': 'AED 15,000 - 22,000',
        'type': 'FULL_TIME',
        'jobLevel': 'MID',
        'workType': 'REMOTE',
        'status': 'ACTIVE',
        'shortDescription': 'Create amazing user experiences for our digital products.',
        'applicants': 15.0,
        'views': 203.0,
        'featured': true,
        'deadline': DateTime.now().add(const Duration(days: 7)).toIso8601String(),
        'createdAt': DateTime.now().subtract(const Duration(days: 1)).toIso8601String(),
        'updatedAt': DateTime.now().toIso8601String(),
        'company': {
          'id': 'mock-company-3',
          'name': 'DesignStudio',
          'logo': null,
          'industry': 'Design',
          'size': '11-50',
          'location': 'Dubai, UAE',
        },
        'postedBy': {
          'id': 'mock-user-3',
          'name': 'Mike Chen',
          'avatar': null,
        },
      },
    ];

    // Add any newly created jobs to the list
    final allJobsData = [...mockJobsData, ..._mockCreatedJobs];

    debugPrint('‚úÖ Mock jobs fetched successfully (${allJobsData.length} jobs)');
    debugPrint('üìä Mock jobs: ${mockJobsData.length}, Created jobs: ${_mockCreatedJobs.length}');
    if (_mockCreatedJobs.isNotEmpty) {
      debugPrint('üÜï Newly created jobs:');
      for (var job in _mockCreatedJobs) {
        debugPrint('   - ${job['title']} (ID: ${job['id']})');
      }
    }
    return allJobsData.map((json) => Job.fromJson(json)).toList();
    */
    // ORIGINAL CODE - Uncomment when backend is ready
    const String query = '''
      query GetJobs(\$filter: JobFilterInput, \$pagination: PaginationInput) {
        jobs(filter: \$filter, pagination: \$pagination) {
          id
          slug
          title
          department
          location
          salary
          type
          jobLevel
          workType
          status
          shortDescription
          applicants
          views
          featured
          deadline
          createdAt
          updatedAt
          company {
            id
            name
            logo
            industry
            size
            location
          }
          postedBy {
            id
            name
            avatar
          }
        }
      }
    ''';

    final variables = {
      'filter': {
        if (type != null) 'type': type.toJson(),
        if (jobLevel != null) 'jobLevel': jobLevel.toJson(),
        if (workType != null) 'workType': workType.toJson(),
        if (status != null) 'status': status.toJson(),
        if (industry != null) 'industry': industry,
        if (location != null) 'location': location,
        if (department != null) 'department': department,
        if (companyId != null) 'companyId': companyId,
        if (featured != null) 'featured': featured,
      },
      'pagination': {
        if (limit != null) 'limit': limit,
        if (page != null) 'page': page,
      },
    };

    final result = await GraphQLService.client.query(
      QueryOptions(
        document: gql(query),
        variables: variables,
        fetchPolicy: FetchPolicy.networkOnly,
      ),
    );

    if (result.hasException) {
      debugPrint('‚ùå GraphQL Exception in getJobs: ${result.exception.toString()}');

      // Extract more specific error information
      if (result.exception?.graphqlErrors.isNotEmpty ?? false) {
        for (var error in result.exception!.graphqlErrors) {
          debugPrint('  - GraphQL Error: ${error.message}');
          debugPrint('  - Extensions: ${error.extensions}');
        }
      }

      if (result.exception?.linkException != null) {
        debugPrint('  - Link Exception: ${result.exception!.linkException}');
      }

      throw Exception(result.exception.toString());
    }

    final List<dynamic> jobsData = result.data?['jobs'] ?? [];
    return jobsData.map((json) => Job.fromJson(json)).toList();
    /*
    // ORIGINAL CODE - Uncomment when backend is ready
    const String query = '''
      query GetJobs(\$filter: JobFilterInput, \$pagination: PaginationInput) {
        jobs(filter: \$filter, pagination: \$pagination) {
          id
          slug
          title
          department
          location
          salary
          type
          jobLevel
          workType
          status
          shortDescription
          applicants
          views
          featured
          deadline
          createdAt
          updatedAt
          company {
            id
            name
            logo
            industry
            size
            location
          }
          postedBy {
            id
            name
            avatar
          }
        }
      }
    ''';

    final variables = {
      'filter': {
        if (type != null) 'type': type.toJson(),
        if (jobLevel != null) 'jobLevel': jobLevel.toJson(),
        if (workType != null) 'workType': workType.toJson(),
        if (status != null) 'status': status.toJson(),
        if (industry != null) 'industry': industry,
        if (location != null) 'location': location,
        if (department != null) 'department': department,
        if (companyId != null) 'companyId': companyId,
        if (featured != null) 'featured': featured,
      },
      'pagination': {
        if (limit != null) 'limit': limit,
        if (page != null) 'page': page,
      },
    };

    final result = await GraphQLService.client.query(
      QueryOptions(
        document: gql(query),
        variables: variables,
        fetchPolicy: FetchPolicy.networkOnly,
      ),
    );

    if (result.hasException) {
      debugPrint('‚ùå GraphQL Exception in getJobs: ${result.exception.toString()}');

      // Extract more specific error information
      if (result.exception?.graphqlErrors.isNotEmpty ?? false) {
        for (var error in result.exception!.graphqlErrors) {
          debugPrint('  - GraphQL Error: ${error.message}');
          debugPrint('  - Extensions: ${error.extensions}');
        }
      }

      if (result.exception?.linkException != null) {
        debugPrint('  - Link Exception: ${result.exception!.linkException}');
      }

      throw Exception(result.exception.toString());
    }

    final List<dynamic> jobsData = result.data?['jobs'] ?? [];
    return jobsData.map((json) => Job.fromJson(json)).toList();
    */
  }

  /// Get a single job by ID
  Future<Job?> getJob(String id) async {
    debugPrint('üîß JobService.getJob called with id: $id');

    /*
    // TEMPORARY: Mock implementation for testing
    debugPrint('üé≠ Using mock implementation for single job fetch');
    debugPrint('üìä Total stored created jobs: ${_mockCreatedJobs.length}');

    // First check if it's a newly created job
    debugPrint('üîç Checking for newly created job with ID: $id');
    for (var job in _mockCreatedJobs) {
      debugPrint('   - Stored job ID: ${job['id']}, Title: ${job['title']}');
      if (job['id'] == id) {
        debugPrint('‚úÖ Found newly created job: ${job['title']}');
        return Job.fromJson(job);
      }
    }

    debugPrint('‚ùå Job not found in created jobs, checking mock data...');

    // Return mock job data for the requested ID (only for existing mock jobs)
    if (id == 'mock-job-1') {
      debugPrint('‚úÖ Returning mock job: Senior Software Engineer');
      final mockJobData = {
        'id': id,
        'slug': 'senior-software-engineer',
        'title': 'Senior Software Engineer',
        'department': 'Engineering',
        'location': 'Dubai, UAE',
        'salary': 'AED 25,000 - 35,000',
        'type': 'FULL_TIME',
        'jobLevel': 'SENIOR',
        'workType': 'ONSITE',
        'status': 'ACTIVE',
        'description': 'We are looking for a Senior Software Engineer to join our dynamic team. You will be working on cutting-edge technologies and contributing to innovative projects that impact millions of users.',
        'shortDescription': 'We are looking for a Senior Software Engineer to join our team.',
        'responsibilities': '‚Ä¢ Design and develop scalable software solutions\n‚Ä¢ Collaborate with cross-functional teams\n‚Ä¢ Mentor junior developers\n‚Ä¢ Participate in code reviews',
        'requirements': '‚Ä¢ 5+ years of software development experience\n‚Ä¢ Strong knowledge of Flutter/Dart\n‚Ä¢ Experience with GraphQL\n‚Ä¢ Bachelor\'s degree in Computer Science',
        'benefits': '‚Ä¢ Competitive salary\n‚Ä¢ Health insurance\n‚Ä¢ Flexible working hours\n‚Ä¢ Professional development opportunities',
        'skills': ['Flutter', 'Dart', 'GraphQL', 'Firebase', 'Git'],
        'applicants': 12.0,
        'views': 156.0,
        'featured': true,
        'deadline': DateTime.now().add(const Duration(days: 14)).toIso8601String(),
        'cvAnalysisPrompt': 'Analyze the candidate\'s experience with mobile development',
        'interviewPrompt': 'Focus on technical skills and problem-solving abilities',
        'aiSecondInterviewPrompt': 'Evaluate cultural fit and long-term potential',
        'interviewLanguage': 'English',
        'createdAt': DateTime.now().subtract(const Duration(days: 2)).toIso8601String(),
        'updatedAt': DateTime.now().subtract(const Duration(days: 1)).toIso8601String(),
        'company': {
          'id': 'mock-company-1',
          'name': 'TechCorp Solutions',
          'description': 'Leading technology company specializing in mobile and web solutions',
          'website': 'https://techcorp.com',
          'email': 'careers@techcorp.com',
          'phone': '+971-4-123-4567',
          'logo': null,
          'industry': 'Technology',
          'size': '201-500',
          'location': 'Dubai, UAE',
          'founded': '2015',
        },
        'postedBy': {
          'id': 'mock-user-1',
          'name': 'John Smith',
          'email': 'john.smith@techcorp.com',
          'avatar': null,
        },
      };

      debugPrint('‚úÖ Mock job fetched successfully');
      return Job.fromJson(mockJobData);
    }

    // Job not found
    debugPrint('‚ùå Job not found: $id');
    return null;
    */
    // ORIGINAL CODE - Uncomment when backend is ready
    const String query = '''
      query GetJob(\$id: ID!) {
        job(id: \$id) {
          id
          slug
          title
          department
          location
          salary
          type
          jobLevel
          workType
          status
          description
          shortDescription
          responsibilities
          requirements
          benefits
          skills
          applicants
          views
          featured
          deadline
          cvAnalysisPrompt
          interviewPrompt
          aiSecondInterviewPrompt
          interviewLanguage
          createdAt
          updatedAt
          company {
            id
            name
            logo
            website
            email
            phone
            industry
            size
            location
            description
            founded
          }
          postedBy {
            id
            name
            email
            avatar
          }
        }
      }
    ''';

    final result = await GraphQLService.client.query(
      QueryOptions(
        document: gql(query),
        variables: {'id': id},
        fetchPolicy: FetchPolicy.networkOnly,
      ),
    );

    if (result.hasException) {
      debugPrint('‚ùå GraphQL Exception in getJob: ${result.exception.toString()}');
      if (result.exception?.graphqlErrors.isNotEmpty ?? false) {
        for (var error in result.exception!.graphqlErrors) {
          debugPrint('  - GraphQL Error: ${error.message}');
          debugPrint('  - Extensions: ${error.extensions}');
        }
      }
      throw Exception(result.exception.toString());
    }

    final jobData = result.data?['job'];
    return jobData != null ? Job.fromJson(jobData) : null;
  }

  /// Get a single job by slug
  Future<Job?> getJobBySlug(String slug) async {
    const String query = '''
      query GetJobBySlug(\$slug: String!) {
        jobBySlug(slug: \$slug) {
          id
          slug
          title
          department
          location
          salary
          type
          jobLevel
          workType
          status
          description
          shortDescription
          responsibilities
          requirements
          benefits
          skills
          applicants
          views
          featured
          deadline
          cvAnalysisPrompt
          interviewPrompt
          aiSecondInterviewPrompt
          createdAt
          updatedAt
          company {
            id
            name
            logo
            website
            email
            phone
            industry
            size
            location
            description
            founded
          }
          postedBy {
            id
            name
            email
            avatar
          }
        }
      }
    ''';

    final result = await GraphQLService.client.query(
      QueryOptions(
        document: gql(query),
        variables: {'slug': slug},
        fetchPolicy: FetchPolicy.networkOnly,
      ),
    );

    if (result.hasException) {
      throw Exception(result.exception.toString());
    }

    final jobData = result.data?['jobBySlug'];
    return jobData != null ? Job.fromJson(jobData) : null;
  }

    /// Get jobs posted by the current user's company
  Future<List<Job>> getCompanyJobs() async {
    debugPrint('üîß JobService.getCompanyJobs called');

    // TEMPORARY: Mock implementation for testing
    debugPrint('üé≠ Using mock implementation for company jobs fetching');

    // Simulate API delay
    await Future.delayed(const Duration(seconds: 1));

    // Create mock jobs data (same as getJobs but filtered for company)
    final mockJobsData = [
      {
        'id': 'mock-job-1',
        'slug': 'senior-software-engineer',
        'title': 'Senior Software Engineer',
        'department': 'Engineering',
        'location': 'Dubai, UAE',
        'salary': 'AED 25,000 - 35,000',
        'type': 'FULL_TIME',
        'jobLevel': 'SENIOR',
        'workType': 'ONSITE',
        'status': 'ACTIVE',
        'shortDescription': 'We are looking for a Senior Software Engineer to join our team.',
        'applicants': 12.0,
        'views': 156.0,
        'featured': true,
        'deadline': DateTime.now().add(const Duration(days: 14)).toIso8601String(),
        'createdAt': DateTime.now().subtract(const Duration(days: 2)).toIso8601String(),
        'updatedAt': DateTime.now().subtract(const Duration(days: 1)).toIso8601String(),
        'company': {
          'id': 'mock-company-1',
          'name': 'TechCorp Solutions',
          'logo': null,
          'industry': 'Technology',
          'size': '201-500',
          'location': 'Dubai, UAE',
        },
        'postedBy': {
          'id': 'mock-user-1',
          'name': 'John Smith',
          'avatar': null,
        },
      },
      {
        'id': 'mock-job-2',
        'slug': 'product-manager',
        'title': 'Product Manager',
        'department': 'Product',
        'location': 'Abu Dhabi, UAE',
        'salary': 'AED 20,000 - 30,000',
        'type': 'FULL_TIME',
        'jobLevel': 'MID',
        'workType': 'HYBRID',
        'status': 'ACTIVE',
        'shortDescription': 'Join our product team to drive innovation and user experience.',
        'applicants': 8.0,
        'views': 89.0,
        'featured': false,
        'deadline': DateTime.now().add(const Duration(days: 21)).toIso8601String(),
        'createdAt': DateTime.now().subtract(const Duration(days: 5)).toIso8601String(),
        'updatedAt': DateTime.now().subtract(const Duration(days: 3)).toIso8601String(),
        'company': {
          'id': 'mock-company-2',
          'name': 'InnovateLabs',
          'logo': null,
          'industry': 'Technology',
          'size': '51-200',
          'location': 'Abu Dhabi, UAE',
        },
        'postedBy': {
          'id': 'mock-user-2',
          'name': 'Sarah Johnson',
          'avatar': null,
        },
      },
    ];

    // Add any newly created jobs from persistent storage
    final createdJobs = _mockCreatedJobs;
    final allJobsData = [...mockJobsData, ...createdJobs];

    debugPrint('‚úÖ Mock company jobs fetched successfully (${allJobsData.length} jobs)');
    debugPrint('üìä Mock jobs: ${mockJobsData.length}, Created jobs: ${createdJobs.length}');
    debugPrint('üìã Total jobs from persistent storage: ${createdJobs.length}');
    if (createdJobs.isNotEmpty) {
      debugPrint('üÜï Newly created jobs from storage:');
      for (var job in createdJobs) {
        debugPrint('   - ${job['title']} (ID: ${job['id']})');
      }
    } else {
      debugPrint('‚ö†Ô∏è No jobs found in persistent storage - post a job to see it here');
    }
    return allJobsData.map((json) => Job.fromJson(json)).toList();
    
    /*
    // ORIGINAL CODE - Uncomment when backend is ready
    const String query = '''
      query GetCompanyJobs {
        companyJobs {
          id
          slug
          title
          department
          location
          salary
          type
          jobLevel
          workType
          status
          applicants
          views
          featured
          deadline
          createdAt
          updatedAt
        }
      }
    ''';

    final result = await GraphQLService.client.query(
      QueryOptions(
        document: gql(query),
        fetchPolicy: FetchPolicy.networkOnly,
      ),
    );

    if (result.hasException) {
      throw Exception(result.exception.toString());
    }

    final List<dynamic> jobsData = result.data?['companyJobs'] ?? [];
    return jobsData.map((json) => Job.fromJson(json)).toList();
    */

    /*
    // ORIGINAL CODE - Uncomment when backend is ready
    const String query = '''
      query GetCompanyJobs {
        companyJobs {
          id
          slug
          title
          department
          location
          salary
          type
          jobLevel
          workType
          status
          applicants
          views
          featured
          deadline
          createdAt
          updatedAt
        }
      }
    ''';

    final result = await GraphQLService.client.query(
      QueryOptions(
        document: gql(query),
        fetchPolicy: FetchPolicy.networkOnly,
      ),
    );

    if (result.hasException) {
      throw Exception(result.exception.toString());
    }

    final List<dynamic> jobsData = result.data?['companyJobs'] ?? [];
    return jobsData.map((json) => Job.fromJson(json)).toList();
    */
  }

  /// Get a single job by ID
  Future<Job?> getJobById(String jobId) async {
    debugPrint('üîß JobService.getJobById called with id: $jobId');
    
    // TEMPORARY: Mock implementation for testing
    debugPrint('üé≠ Using mock implementation for job fetching by ID');
    
    // Simulate API delay
    await Future.delayed(const Duration(milliseconds: 800));
    
    // Check if it's a created job
    try {
      final createdJob = _mockCreatedJobs.firstWhere(
        (job) => job['id'] == jobId,
      );
      debugPrint('‚úÖ Found created job: ${createdJob['title']}');
      return Job.fromJson(createdJob);
    } catch (e) {
      // Not found in created jobs, continue to mock jobs
    }
    
    // Check mock jobs
    final mockJobsData = [
      {
        'id': 'mock-job-1',
        'slug': 'senior-software-engineer',
        'title': 'Senior Software Engineer',
        'department': 'Engineering',
        'location': 'Dubai, UAE',
        'salary': 'AED 25,000 - 35,000',
        'type': 'FULL_TIME',
        'jobLevel': 'SENIOR',
        'workType': 'ONSITE',
        'status': 'ACTIVE',
        'description': 'We are looking for an experienced Senior Software Engineer to join our growing team. You will work on cutting-edge projects using modern technologies and frameworks.\n\nThis is a great opportunity to work with a talented team and make a significant impact on our products.',
        'shortDescription': 'We are looking for a Senior Software Engineer to join our team.',
        'responsibilities': '‚Ä¢ Lead technical design and architecture decisions\n‚Ä¢ Mentor junior developers\n‚Ä¢ Write clean, maintainable, and efficient code\n‚Ä¢ Participate in code reviews\n‚Ä¢ Collaborate with product managers and designers',
        'requirements': '‚Ä¢ 5+ years of software development experience\n‚Ä¢ Strong knowledge of backend technologies\n‚Ä¢ Experience with cloud platforms (AWS, Azure, or GCP)\n‚Ä¢ Excellent problem-solving skills\n‚Ä¢ Strong communication skills',
        'benefits': '‚Ä¢ Competitive salary\n‚Ä¢ Health insurance\n‚Ä¢ Annual bonus\n‚Ä¢ Flexible working hours\n‚Ä¢ Remote work options\n‚Ä¢ Professional development budget',
        'skills': ['JavaScript', 'Node.js', 'React', 'TypeScript', 'AWS'],
        'experience': '5+ years',
        'education': 'Bachelor\'s degree in Computer Science or related field',
        'industry': 'Technology',
        'applicants': 12.0,
        'views': 156.0,
        'featured': true,
        'deadline': DateTime.now().add(const Duration(days: 14)).toIso8601String(),
        'createdAt': DateTime.now().subtract(const Duration(days: 2)).toIso8601String(),
        'updatedAt': DateTime.now().subtract(const Duration(days: 1)).toIso8601String(),
        'company': {
          'id': 'mock-company-1',
          'name': 'TechCorp Solutions',
          'description': 'A leading technology company',
          'logo': null,
          'industry': 'Technology',
          'size': '201-500',
          'location': 'Dubai, UAE',
        },
        'postedBy': {
          'id': 'mock-user-1',
          'name': 'John Smith',
          'avatar': null,
        },
      },
      {
        'id': 'mock-job-2',
        'slug': 'product-manager',
        'title': 'Product Manager',
        'department': 'Product',
        'location': 'Abu Dhabi, UAE',
        'salary': 'AED 20,000 - 30,000',
        'type': 'FULL_TIME',
        'jobLevel': 'MID',
        'workType': 'HYBRID',
        'status': 'ACTIVE',
        'description': 'Join our product team to drive innovation and user experience. As a Product Manager, you will be responsible for defining product vision and strategy.\n\nYou will work closely with engineering, design, and business teams to deliver exceptional products.',
        'shortDescription': 'Join our product team to drive innovation and user experience.',
        'responsibilities': '‚Ä¢ Define product roadmap and strategy\n‚Ä¢ Work with stakeholders to gather requirements\n‚Ä¢ Prioritize features and enhancements\n‚Ä¢ Analyze user feedback and metrics\n‚Ä¢ Lead product launches',
        'requirements': '‚Ä¢ 3+ years of product management experience\n‚Ä¢ Strong analytical skills\n‚Ä¢ Experience with agile methodologies\n‚Ä¢ Excellent communication skills\n‚Ä¢ Data-driven decision making',
        'benefits': '‚Ä¢ Competitive compensation\n‚Ä¢ Health and dental insurance\n‚Ä¢ Stock options\n‚Ä¢ Gym membership\n‚Ä¢ Team building events\n‚Ä¢ Learning and development opportunities',
        'skills': ['Product Management', 'Agile', 'Data Analysis', 'User Research', 'SQL'],
        'experience': '3+ years',
        'education': 'Bachelor\'s degree in Business, Engineering, or related field',
        'industry': 'Technology',
        'applicants': 8.0,
        'views': 89.0,
        'featured': false,
        'deadline': DateTime.now().add(const Duration(days: 21)).toIso8601String(),
        'createdAt': DateTime.now().subtract(const Duration(days: 5)).toIso8601String(),
        'updatedAt': DateTime.now().subtract(const Duration(days: 3)).toIso8601String(),
        'company': {
          'id': 'mock-company-2',
          'name': 'InnovateLabs',
          'description': 'Innovation at its finest',
          'logo': null,
          'industry': 'Technology',
          'size': '51-200',
          'location': 'Abu Dhabi, UAE',
        },
        'postedBy': {
          'id': 'mock-user-2',
          'name': 'Sarah Johnson',
          'avatar': null,
        },
      },
    ];
    
    try {
      final mockJob = mockJobsData.firstWhere(
        (job) => job['id'] == jobId,
      );
      debugPrint('‚úÖ Found mock job: ${mockJob['title']}');
      return Job.fromJson(mockJob);
    } catch (e) {
      debugPrint('‚ùå Job not found with id: $jobId');
      return null;
    }
  }

  /// Check if a job is saved
  Future<bool> isJobSaved(String jobId) async {
    debugPrint('üîß JobService.isJobSaved called with jobId: $jobId');

    // TEMPORARY: Mock implementation for testing
    debugPrint('üé≠ Using mock implementation for job saved check');

    // Simulate API delay
    await Future.delayed(const Duration(milliseconds: 300));

    // Mock: randomly return true/false for testing
    final isSaved = jobId.hashCode % 2 == 0;
    debugPrint('‚úÖ Job saved status: $isSaved');
    return isSaved;
  }

  /// Save a job to favorites
  Future<bool> saveJob(String jobId, {String? notes}) async {
    debugPrint('üîß JobService.saveJob called with jobId: $jobId');

    // TEMPORARY: Mock implementation for testing
    debugPrint('üé≠ Using mock implementation for job saving');

    // Simulate API delay
    await Future.delayed(const Duration(milliseconds: 500));

    debugPrint('‚úÖ Job saved successfully');
    return true;
  }

  /// Remove a job from favorites
  Future<bool> unsaveJob(String jobId) async {
    debugPrint('üîß JobService.unsaveJob called with jobId: $jobId');

    // TEMPORARY: Mock implementation for testing
    debugPrint('üé≠ Using mock implementation for job unsaving');

    // Simulate API delay
    await Future.delayed(const Duration(milliseconds: 500));

    debugPrint('‚úÖ Job unsaved successfully');
    return true;
  }

  /// Get all saved jobs
  Future<List<SavedJob>> getSavedJobs() async {
    // TEMPORARY: Mock implementation for testing
    debugPrint('üé≠ Using mock implementation for getting saved jobs');

    // Simulate API delay
    await Future.delayed(const Duration(milliseconds: 300));

    // Return empty list initially - jobs will be saved as user interacts
    debugPrint('‚úÖ Mock saved jobs fetched successfully (0 jobs)');
    return [];
  }

  /// Create a new job
  Future<Job> createJob({
    required String title,
    required String department,
    required String location,
    required String salary,
    required JobType type,
    required JobLevel jobLevel,
    required WorkType workType,
    required String description,
    required String shortDescription,
    String? responsibilities,
    String? requirements,
    String? benefits,
    List<String>? skills,
    required DateTime deadline,
  }) async {
    debugPrint('üîß JobService.createJob called with title: $title');
    
    // TEMPORARY: Mock implementation for testing
    debugPrint('üé≠ Using mock implementation for job creation');
    
    // Simulate API delay
    await Future.delayed(const Duration(seconds: 2));
    
    // Create a mock job response
    final mockJobData = {
      'id': 'mock-job-${DateTime.now().millisecondsSinceEpoch}',
      'slug': title.toLowerCase().replaceAll(' ', '-'),
      'title': title,
      'department': department,
      'location': location,
      'salary': salary,
      'type': type.toJson(),
      'jobLevel': jobLevel.toJson(),
      'workType': workType.toJson(),
      'status': 'ACTIVE',
      'description': description,
      'shortDescription': shortDescription,
      'responsibilities': responsibilities,
      'requirements': requirements,
      'benefits': benefits,
      'skills': skills,
      'deadline': deadline.toIso8601String(),
      'createdAt': DateTime.now().toIso8601String(),
      'updatedAt': DateTime.now().toIso8601String(),
      'featured': false,
      'applicants': 0.0,
      'views': 0.0,
      'company': {
        'id': 'mock-company-id',
        'name': 'Mock Company',
        'description': 'A mock company for testing',
        'website': 'https://mockcompany.com',
        'email': 'contact@mockcompany.com',
        'phone': '+971-50-123-4567',
        'logo': null,
        'industry': 'Technology',
        'size': '51-200',
        'location': 'Dubai, UAE',
        'createdAt': DateTime.now().toIso8601String(),
        'updatedAt': DateTime.now().toIso8601String(),
      },
      'postedBy': {
        'id': 'mock-user-id',
        'userType': 'BUSINESS',
        'email': 'business@mockcompany.com',
        'name': 'Mock Business User',
        'phone': '+971-50-123-4567',
        'avatar': null,
        'isActive': true,
        'createdAt': DateTime.now().toIso8601String(),
        'updatedAt': DateTime.now().toIso8601String(),
      },
    };
    
    // Store the created job for future retrieval in persistent storage
    final currentJobs = _mockCreatedJobs;
    currentJobs.add(mockJobData);
    _saveMockJobs(currentJobs);
    
    debugPrint('‚úÖ Mock job created and stored successfully');
    debugPrint('üìù Created job: ${mockJobData['title']} (ID: ${mockJobData['id']})');
    debugPrint('üìä Total stored jobs: ${currentJobs.length}');
    debugPrint('üíæ Jobs persisted to storage');
    return Job.fromJson(mockJobData);
    
    /*
    // ORIGINAL CODE - Uncomment when backend is ready
    const String mutation = '''
      mutation CreateJob(\$input: CreateJobInput!) {
        createJob(input: \$input) {
          id
          slug
          title
          department
          location
          salary
          type
          jobLevel
          workType
          status
          description
          shortDescription
          responsibilities
          requirements
          benefits
          skills
          deadline
          createdAt
          updatedAt
        }
      }
    ''';

    final variables = {
      'input': {
        'title': title,
        'department': department,
        'location': location,
        'salary': salary,
        'type': type.toJson(),
        'jobLevel': jobLevel.toJson(),
        'workType': workType.toJson(),
        'description': description,
        'shortDescription': shortDescription,
        'responsibilities': responsibilities,
        'requirements': requirements,
        'benefits': benefits,
        'skills': skills,
        'deadline': deadline.toIso8601String(),
      },
    };

    debugPrint('üì° Sending GraphQL mutation with variables: $variables');

    final result = await GraphQLService.client.mutate(
      MutationOptions(
        document: gql(mutation),
        variables: variables,
        fetchPolicy: FetchPolicy.networkOnly,
      ),
    ).timeout(
      const Duration(seconds: 30),
      onTimeout: () {
        debugPrint('‚è±Ô∏è Job creation timeout after 30 seconds');
        throw Exception('Request timeout - please check your connection and try again');
      },
    );

    debugPrint('üì° GraphQL response received');
    
    if (result.hasException) {
      debugPrint('‚ùå GraphQL exception: ${result.exception.toString()}');
      if (result.exception?.graphqlErrors.isNotEmpty ?? false) {
        for (var error in result.exception!.graphqlErrors) {
          debugPrint('  - GraphQL Error: ${error.message}');
          debugPrint('  - Extensions: ${error.extensions}');
        }
      }
      throw Exception(result.exception.toString());
    }

    final jobData = result.data?['createJob'];
    debugPrint('üì¶ Job data received: $jobData');
    
    if (jobData == null) {
      debugPrint('‚ùå Job data is null');
      throw Exception('Failed to create job');
    }

    debugPrint('‚úÖ Job created successfully');
    return Job.fromJson(jobData);
    */
  }
}
