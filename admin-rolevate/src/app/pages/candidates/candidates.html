<!-- Candidates Management Page -->
<div class="p-6 space-y-8">
  <!-- Page Header -->
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-6">
    <div>
      <h1 class="text-3xl font-bold text-gray-900">Candidates</h1>
      <p class="text-gray-600 mt-2">Manage and monitor registered candidates</p>
    </div>
    <div class="flex items-center space-x-4">
      @if (pagination(); as pag) {
        <span class="text-sm text-gray-500 px-3 py-1 bg-gray-100 rounded-full">
          {{ pag.totalItems }} total candidates
        </span>
      }
      <app-button
        variant="outline"
        size="sm"
        (clicked)="exportCandidates()"
        [disabled]="loading()"
      >
        Export CSV
      </app-button>
      <app-button
        variant="primary"
        size="sm"
        (clicked)="refreshData()"
        [disabled]="loading()"
      >
        Refresh
      </app-button>
    </div>
  </div>

  <!-- Advanced Filters -->
  <app-card>
    <div class="p-6 space-y-6">
      <!-- Primary Filters Row -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- Search -->
        <div class="lg:col-span-2">
          <label class="block text-sm font-medium text-gray-700 mb-3">Search</label>
          <input
            type="text"
            [(ngModel)]="searchTerm"
            (ngModelChange)="onSearch()"
            placeholder="Search by name, email, or skills..."
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-colors"
          />
        </div>

        <!-- Experience Level -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-3">Experience Level</label>
          <select
            [(ngModel)]="selectedExperienceLevel"
            (ngModelChange)="onFilterChange()"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-colors"
          >
            <option value="">All Levels</option>
            <option value="entry">Entry Level</option>
            <option value="mid">Mid Level</option>
            <option value="senior">Senior Level</option>
            <option value="executive">Executive</option>
          </select>
        </div>

        <!-- Work Type -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-3">Work Type</label>
          <select
            [(ngModel)]="selectedWorkType"
            (ngModelChange)="onFilterChange()"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-colors"
          >
            <option value="">All Types</option>
            <option value="remote">Remote</option>
            <option value="hybrid">Hybrid</option>
            <option value="onsite">On-site</option>
          </select>
        </div>
      </div>

      <!-- Secondary Filters Row -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- Status -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-3">Status</label>
          <select
            [(ngModel)]="selectedStatus"
            (ngModelChange)="onFilterChange()"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-colors"
          >
            <option value="">All Status</option>
            <option value="true">Active</option>
            <option value="false">Inactive</option>
          </select>
        </div>

        <!-- Items per page -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-3">Items per page</label>
          <select
            [(ngModel)]="itemsPerPage"
            (ngModelChange)="onItemsPerPageChange()"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-colors"
          >
            <option [value]="10">10</option>
            <option [value]="25">25</option>
            <option [value]="50">50</option>
            <option [value]="100">100</option>
          </select>
        </div>

        <!-- Sort by -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-3">Sort by</label>
          <select
            [(ngModel)]="sortBy"
            (ngModelChange)="onSortChange()"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-colors"
          >
            <option value="createdAt">Date Joined</option>
            <option value="firstName">Name</option>
            <option value="totalApplications">Applications</option>
            <option value="totalInterviews">Interviews</option>
          </select>
        </div>

        <!-- Sort order -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-3">Order</label>
          <select
            [(ngModel)]="sortOrder"
            (ngModelChange)="onSortChange()"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-colors"
          >
            <option value="asc">Ascending</option>
            <option value="desc">Descending</option>
          </select>
        </div>
      </div>

      <!-- Actions Row -->
      <div class="flex items-center justify-between pt-6 border-t border-gray-200">
        <div class="flex items-center space-x-4">
          @if (selectedCandidates().length > 0) {
            <span class="text-sm text-gray-600 font-medium">
              {{ selectedCandidates().length }} selected
            </span>
            <app-button
              variant="outline"
              size="sm"
              (clicked)="exportSelected()"
            >
              Export Selected
            </app-button>
            <app-button
              variant="outline"
              size="sm"
              (clicked)="toggleSelectedStatus()"
              class="text-orange-600 hover:text-orange-700"
            >
              Toggle Status
            </app-button>
          }
        </div>
        <app-button
          variant="outline"
          size="sm"
          (clicked)="clearFilters()"
        >
          Clear All Filters
        </app-button>
      </div>
    </div>
  </app-card>

  <!-- Candidates Table -->
  <app-card>
    @if (loading()) {
      <div class="flex items-center justify-center py-16">
        <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-cyan-600"></div>
        <span class="ml-4 text-gray-600 text-lg">Loading candidates...</span>
      </div>
    } @else if (error()) {
      <div class="text-center py-16">
        <div class="text-red-600 mb-6 text-lg">{{ error() }}</div>
        <app-button variant="outline" (clicked)="loadCandidates()">
          Try Again
        </app-button>
      </div>
    } @else if (candidates().length === 0) {
      <div class="text-center py-16">
        <div class="text-gray-500 mb-6 text-lg">No candidates found</div>
        <app-button variant="outline" (clicked)="clearFilters()">
          Clear Filters
        </app-button>
      </div>
    } @else {
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-6 py-4 text-left">
                <input
                  type="checkbox"
                  [checked]="isAllSelected()"
                  [indeterminate]="isPartiallySelected()"
                  (change)="toggleSelectAll()"
                  class="rounded border-gray-300 text-cyan-600 focus:ring-cyan-500"
                />
              </th>
              <th scope="col" class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer"
                  (click)="sort('firstName')">
                <div class="flex items-center space-x-1">
                  <span>Candidate</span>
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
                  </svg>
                </div>
              </th>
              <th scope="col" class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Activity
              </th>
              <th scope="col" class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer"
                  (click)="sort('isActive')">
                <div class="flex items-center space-x-1">
                  <span>Status</span>
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
                  </svg>
                </div>
              </th>
              <th scope="col" class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer"
                  (click)="sort('createdAt')">
                <div class="flex items-center space-x-1">
                  <span>Joined</span>
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
                  </svg>
                </div>
              </th>
              <th scope="col" class="relative px-6 py-4">
                <span class="sr-only">Actions</span>
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            @for (candidate of candidates(); track candidate.id) {
              <tr class="hover:bg-gray-50 transition-colors duration-150">
                <td class="px-6 py-5">
                  <input
                    type="checkbox"
                    [checked]="isSelected(candidate.id)"
                    (change)="toggleSelect(candidate.id)"
                    class="rounded border-gray-300 text-cyan-600 focus:ring-cyan-500"
                  />
                </td>
                <td class="px-6 py-5">
                  <div class="flex items-center">
                    <div class="flex-shrink-0 h-12 w-12">
                      @if (candidate.user.profilePicture) {
                        <img class="h-12 w-12 rounded-full object-cover" 
                             [src]="candidate.user.profilePicture" 
                             [alt]="candidate.firstName + ' ' + candidate.lastName">
                      } @else {
                        <div class="h-12 w-12 rounded-full bg-cyan-500 flex items-center justify-center text-white font-medium">
                          {{ (candidate.firstName?.charAt(0) || '') + (candidate.lastName?.charAt(0) || '') }}
                        </div>
                      }
                    </div>
                    <div class="ml-4">
                      <div class="text-sm font-medium text-gray-900">
                        {{ candidate.firstName }} {{ candidate.lastName }}
                      </div>
                      <div class="text-sm text-gray-500 mt-1">
                        {{ candidate.email }}
                      </div>
                      @if (candidate.currentJobTitle) {
                        <div class="text-xs text-gray-400 mt-1">
                          {{ candidate.currentJobTitle }}
                          @if (candidate.currentCompany) {
                            at {{ candidate.currentCompany }}
                          }
                        </div>
                      }
                    </div>
                  </div>
                </td>
                <td class="px-6 py-5">
                  <div class="space-y-2">
                    <div class="flex items-center space-x-2">
                      <span class="text-sm font-medium text-gray-900">{{ candidate.totalApplications }}</span>
                      <span class="text-xs text-gray-500">applications</span>
                    </div>
                    <div class="flex items-center space-x-2">
                      <span class="text-sm font-medium text-gray-900">{{ candidate.totalInterviews }}</span>
                      <span class="text-xs text-gray-500">interviews</span>
                    </div>
                  </div>
                </td>
                <td class="px-6 py-5">
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium"
                        [ngClass]="candidate.isActive ? 
                          'bg-green-100 text-green-800' : 
                          'bg-red-100 text-red-800'">
                    {{ candidate.isActive ? 'Active' : 'Inactive' }}
                  </span>
                </td>
                <td class="px-6 py-5 text-sm text-gray-500">
                  {{ formatDate(candidate.createdAt) }}
                </td>
                <td class="px-6 py-5 text-right text-sm font-medium">
                  <div class="relative inline-block text-left">
                    <button
                      type="button"
                      (click)="toggleMenu(candidate.id)"
                      class="inline-flex items-center p-2 text-gray-400 hover:text-gray-600 focus:outline-none rounded-full hover:bg-gray-100 transition-colors"
                    >
                      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"/>
                      </svg>
                    </button>

                    @if (openMenus().has(candidate.id)) {
                      <div class="origin-top-right absolute right-0 mt-2 w-56 rounded-lg shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-10">
                        <div class="py-2">
                          <button
                            (click)="viewCandidate(candidate.id)"
                            class="block w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-gray-100 transition-colors"
                          >
                            View Details
                          </button>
                          <button
                            (click)="editCandidate(candidate.id)"
                            class="block w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-gray-100 transition-colors"
                          >
                            Edit Profile
                          </button>
                          @if (candidate.resumeUrl) {
                            <a
                              [href]="candidate.resumeUrl"
                              target="_blank"
                              class="block w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-gray-100 transition-colors"
                            >
                              View Resume
                            </a>
                          }
                          <hr class="my-2">
                          <button
                            (click)="viewCandidateInterviews(candidate.id)"
                            class="block w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-gray-100 transition-colors"
                          >
                            View Interviews
                          </button>
                          @if (candidate.upcomingInterviews && candidate.upcomingInterviews.length > 0) {
                            <button
                              (click)="scheduleInterview(candidate.id)"
                              class="block w-full text-left px-4 py-3 text-sm text-blue-700 hover:bg-gray-100 transition-colors"
                            >
                              Schedule Interview
                            </button>
                          }
                          <hr class="my-2">
                          <button
                            (click)="toggleCandidateStatus(candidate.id)"
                            class="block w-full text-left px-4 py-3 text-sm hover:bg-gray-100 transition-colors"
                            [ngClass]="candidate.isActive ? 'text-red-700' : 'text-green-700'"
                          >
                            {{ candidate.isActive ? 'Deactivate' : 'Activate' }}
                          </button>
                        </div>
                      </div>
                    }
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }
  </app-card>

  <!-- Pagination -->
  @if (pagination(); as pag) {
    <div class="flex items-center justify-between bg-white px-6 py-4 border border-gray-200 rounded-lg">
      <div class="flex-1 flex justify-between sm:hidden">
        <app-button
          variant="outline"
          [disabled]="!pag.hasPrevPage"
          (clicked)="onPageChange(currentPage() - 1)"
        >
          Previous
        </app-button>
        <app-button
          variant="outline"
          [disabled]="!pag.hasNextPage"
          (clicked)="onPageChange(currentPage() + 1)"
        >
          Next
        </app-button>
      </div>
      <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
        <div>
          <p class="text-sm text-gray-700">
            Showing
            <span class="font-medium">{{ (pag.currentPage - 1) * pag.itemsPerPage + 1 }}</span>
            to
            <span class="font-medium">{{ Math.min(pag.currentPage * pag.itemsPerPage, pag.totalItems) }}</span>
            of
            <span class="font-medium">{{ pag.totalItems }}</span>
            results
          </p>
        </div>
        <div>
          <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px">
            <button
              [disabled]="!pag.hasPrevPage"
              (click)="onPageChange(currentPage() - 1)"
              class="relative inline-flex items-center px-3 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
            >
              Previous
            </button>
            
            @for (page of getPageNumbers(); track page) {
              <button
                (click)="onPageChange(page)"
                [class]="page === currentPage() 
                  ? 'relative inline-flex items-center px-4 py-2 border text-sm font-medium bg-cyan-50 border-cyan-500 text-cyan-600'
                  : 'relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors'"
              >
                {{ page }}
              </button>
            }
            
            <button
              [disabled]="!pag.hasNextPage"
              (click)="onPageChange(currentPage() + 1)"
              class="relative inline-flex items-center px-3 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
            >
              Next
            </button>
          </nav>
        </div>
      </div>
    </div>
  }
</div>
