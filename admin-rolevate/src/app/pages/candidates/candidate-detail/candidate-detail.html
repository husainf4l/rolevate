<div class="p-6 max-w-7xl mx-auto space-y-10">
  <!-- Header with Back Button -->
  <div class="flex items-center justify-between">
    <div class="flex items-center space-x-6">
      <app-button
        variant="outline"
        size="sm"
        (clicked)="goBack()"
        class="flex items-center"
      >
        <app-icon name="arrow-left" class="w-4 h-4 mr-2"></app-icon>
        Back to Candidates
      </app-button>
      <div>
        <h1 class="text-3xl font-bold text-gray-900">
          {{ candidate()?.firstName }} {{ candidate()?.lastName }}
        </h1>
        <p class="text-gray-600 mt-1">Candidate Profile & Details</p>
      </div>
    </div>
    <div class="flex items-center space-x-4">
      @if (candidate()?.resumeUrl) {
        <app-button
          variant="outline"
          size="sm"
          (clicked)="openResume()"
          class="flex items-center"
        >
          <app-icon name="document" class="w-4 h-4 mr-2"></app-icon>
          View Resume
        </app-button>
      }
      @if (candidate()?.portfolioUrl) {
        <app-button
          variant="outline"
          size="sm"
          (clicked)="openPortfolio()"
          class="flex items-center"
        >
          <app-icon name="globe" class="w-4 h-4 mr-2"></app-icon>
          Portfolio
        </app-button>
      }
      <app-button
        variant="primary"
        size="sm"
        (clicked)="editCandidate()"
        class="flex items-center"
      >
        <app-icon name="pencil" class="w-4 h-4 mr-2"></app-icon>
        Edit Profile
      </app-button>
    </div>
  </div>

  @if (loading()) {
    <div class="flex items-center justify-center py-20">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-600"></div>
      <span class="ml-4 text-gray-600 text-lg">Loading candidate details...</span>
    </div>
  } @else if (error()) {
    <div class="text-center py-20">
      <div class="text-red-600 mb-6 text-lg">{{ error() }}</div>
      <app-button variant="outline" (clicked)="loadCandidate()">
        Try Again
      </app-button>
    </div>
  } @else if (candidate()) {
    <div class="grid grid-cols-1 xl:grid-cols-4 gap-12">
      <!-- Main Content -->
      <div class="xl:col-span-3">
        <!-- Profile Summary -->
        @if (candidate()?.profileSummary) {
          <app-card class="mb-10" [padding]="false">
            <div class="p-8">
              <h3 class="text-xl font-semibold text-gray-900 mb-4">Profile Summary</h3>
              <p class="text-gray-700 leading-relaxed">{{ candidate()?.profileSummary }}</p>
            </div>
          </app-card>
        }

        <!-- Basic Information -->
        <app-card class="mb-10" [padding]="false">
          <div class="p-8">
            <h3 class="text-xl font-semibold text-gray-900 mb-6">Basic Information</h3>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
              <div class="space-y-6">
                <div>
                  <label class="block text-sm font-medium text-gray-500 mb-1">Full Name</label>
                  <p class="text-base text-gray-900">
                    {{ candidate()?.firstName }} {{ candidate()?.lastName }}
                  </p>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-500 mb-1">Email Address</label>
                  <p class="text-base text-gray-900">{{ candidate()?.email }}</p>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-500 mb-1">Phone Number</label>
                  <p class="text-base text-gray-900">
                    {{ candidate()?.phone || 'Not provided' }}
                  </p>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-500 mb-1">Location</label>
                  <p class="text-base text-gray-900">
                    {{ candidate()?.currentLocation || 'Not specified' }}
                  </p>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-500 mb-1">Nationality</label>
                  <p class="text-base text-gray-900">
                    {{ candidate()?.nationality || 'Not specified' }}
                  </p>
                </div>
              </div>
              <div class="space-y-6">
                <div>
                  <label class="block text-sm font-medium text-gray-500 mb-1">Current Position</label>
                  <p class="text-base text-gray-900">
                    {{ candidate()?.currentJobTitle || 'Not specified' }}
                  </p>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-500 mb-1">Current Company</label>
                  <p class="text-base text-gray-900">
                    {{ candidate()?.currentCompany || 'Not specified' }}
                  </p>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-500 mb-1">Total Experience</label>
                  <p class="text-base text-gray-900">
                    {{ candidate()?.totalExperience ? candidate()?.totalExperience + ' years' : 'Not specified' }}
                  </p>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-500 mb-1">Experience Level</label>
                  <p class="text-base text-gray-900">
                    {{ candidate()?.experienceLevel || 'Not specified' }}
                  </p>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-500 mb-1">Notice Period</label>
                  <p class="text-base text-gray-900">
                    {{ candidate()?.noticePeriod || 'Not specified' }}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </app-card>

        <!-- Education -->
        <app-card class="mb-10">
          <div class="p-8">
            <h3 class="text-xl font-semibold text-gray-900 mb-6">Education</h3>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
              <div class="space-y-6">
                <div>
                  <label class="block text-sm font-medium text-gray-500 mb-1">Highest Education</label>
                  <p class="text-base text-gray-900">
                    {{ candidate()?.highestEducation || 'Not specified' }}
                  </p>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-500 mb-1">Field of Study</label>
                  <p class="text-base text-gray-900">
                    {{ candidate()?.fieldOfStudy || 'Not specified' }}
                  </p>
                </div>
              </div>
              <div class="space-y-6">
                <div>
                  <label class="block text-sm font-medium text-gray-500 mb-1">University</label>
                  <p class="text-base text-gray-900">
                    {{ candidate()?.university || 'Not specified' }}
                  </p>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-500 mb-1">Graduation Year</label>
                  <p class="text-base text-gray-900">
                    {{ candidate()?.graduationYear || 'Not specified' }}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </app-card>

        <!-- Skills -->
        <app-card class="mb-10">
          <div class="p-8">
            <h3 class="text-xl font-semibold text-gray-900 mb-6">Skills & Expertise</h3>
            @if (candidate()?.skills?.length) {
              <div class="flex flex-wrap gap-3">
                @for (skill of candidate()!.skills; track skill) {
                  <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-blue-100 text-blue-800 border border-blue-200">
                    {{ skill }}
                  </span>
                }
              </div>
            } @else {
              <p class="text-gray-500 text-center py-12">No skills listed</p>
            }
          </div>
        </app-card>

        <!-- Preferences -->
        <app-card class="mb-10">
          <div class="p-8">
            <h3 class="text-xl font-semibold text-gray-900 mb-6">Job Preferences</h3>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
              <div class="space-y-6">
                <div>
                  <label class="block text-sm font-medium text-gray-500 mb-1">Preferred Work Type</label>
                  <p class="text-base text-gray-900">
                    {{ candidate()?.preferredWorkType || 'Not specified' }}
                  </p>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-500 mb-1">Expected Salary</label>
                  <p class="text-base text-gray-900">
                    {{ candidate()?.expectedSalary ? ('$' + candidate()?.expectedSalary?.toLocaleString()) : 'Not specified' }}
                  </p>
                </div>
              </div>
              <div class="space-y-6">
                <div>
                  <label class="block text-sm font-medium text-gray-500 mb-1">Preferred Job Types</label>
                  @if (candidate()?.preferredJobTypes?.length) {
                    <div class="flex flex-wrap gap-2">
                      @for (jobType of candidate()!.preferredJobTypes; track jobType) {
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                          {{ jobType }}
                        </span>
                      }
                    </div>
                  } @else {
                    <p class="text-base text-gray-900">Not specified</p>
                  }
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-500 mb-1">Preferred Industries</label>
                  @if (candidate()?.preferredIndustries?.length) {
                    <div class="flex flex-wrap gap-2">
                      @for (industry of candidate()!.preferredIndustries; track industry) {
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                          {{ industry }}
                        </span>
                      }
                    </div>
                  } @else {
                    <p class="text-base text-gray-900">Not specified</p>
                  }
                </div>
              </div>
            </div>
          </div>
        </app-card>

        <!-- Applications History -->
        <app-card class="mb-10">
          <div class="p-8">
            <h3 class="text-xl font-semibold text-gray-900 mb-6">Application History</h3>
            @if (candidate()?.applications?.length) {
              <div class="space-y-6">
                @for (application of candidate()!.applications; track application.id) {
                  <div class="border border-gray-200 rounded-lg p-8 hover:shadow-md transition-shadow bg-white shadow-sm">
                    <div class="flex items-start justify-between">
                      <div class="flex-1">
                        <h4 class="text-lg font-medium text-gray-900 mb-2">
                          {{ application.job.title }}
                        </h4>
                        <p class="text-base text-gray-600 mb-3">
                          {{ application.job.company.name }}
                        </p>
                        @if (application.cvAnalysisScore) {
                          <div class="flex items-center space-x-2 mb-3">
                            <span class="text-sm text-gray-500">CV Analysis Score:</span>
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                                  [ngClass]="getCvScoreClasses(application.cvAnalysisScore)">
                              {{ application.cvAnalysisScore }}/100
                            </span>
                          </div>
                        }
                        @if (application.companyNotes) {
                          <p class="text-sm text-gray-600 mt-2">
                            <span class="font-medium">Company Notes:</span> {{ application.companyNotes }}
                          </p>
                        }
                      </div>
                      <div class="text-right ml-6">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium"
                              [ngClass]="getApplicationStatusClasses(application.status)">
                          {{ formatApplicationStatus(application.status) }}
                        </span>
                        <p class="text-sm text-gray-500 mt-2">
                          Applied {{ formatDate(application.appliedAt) }}
                        </p>
                      </div>
                    </div>
                  </div>
                }
              </div>
            } @else {
              <p class="text-gray-500 text-center py-12">No applications found</p>
            }
          </div>
        </app-card>

        <!-- Interviews History -->
        <app-card class="mb-10">
          <div class="p-8">
            <h3 class="text-xl font-semibold text-gray-900 mb-6">Interview History</h3>
            @if (candidate()?.interviews?.length) {
              <div class="space-y-6">
                @for (interview of candidate()!.interviews; track interview.id) {
                  <div class="border border-gray-200 rounded-lg p-8 hover:shadow-md transition-shadow bg-white shadow-sm">
                    <div class="flex items-start justify-between">
                      <div class="flex-1">
                        <h4 class="text-lg font-medium text-gray-900 mb-2">
                          {{ interview.title }}
                        </h4>
                        <p class="text-base text-gray-600 mb-3">
                          {{ interview.job.company.name }}
                        </p>
                        <div class="flex items-center space-x-4 text-sm text-gray-600">
                          <span>
                            <span class="font-medium">Type:</span> {{ formatInterviewType(interview.type) }}
                          </span>
                          @if (interview.duration) {
                            <span>
                              <span class="font-medium">Duration:</span> {{ interview.duration }} minutes
                            </span>
                          }
                        </div>
                        @if (interview.aiScore) {
                          <div class="flex items-center space-x-2 mt-3">
                            <span class="text-sm text-gray-500">AI Score:</span>
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                                  [ngClass]="getAiScoreClasses(interview.aiScore)">
                              {{ interview.aiScore }}/100
                            </span>
                          </div>
                        }
                      </div>
                      <div class="text-right ml-6">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium"
                              [ngClass]="getInterviewStatusClasses(interview.status)">
                          {{ formatInterviewStatus(interview.status) }}
                        </span>
                        <p class="text-sm text-gray-500 mt-2">
                          {{ formatDate(interview.scheduledAt) }}
                        </p>
                        @if (interview.videoLink) {
                          <button 
                            (click)="openVideoLink(interview.videoLink)"
                            class="text-sm text-cyan-600 hover:text-cyan-700 mt-1 block">
                            View Recording
                          </button>
                        }
                      </div>
                    </div>
                  </div>
                }
              </div>
            } @else {
              <p class="text-gray-500 text-center py-12">No interviews found</p>
            }
          </div>
        </app-card>
      </div>

      <!-- Sidebar -->
      <div>
        <!-- Profile Card -->
        <app-card class="mb-6">
          <div class="p-6 text-center">
            <div class="mx-auto h-24 w-24 mb-4">
              @if (candidate()?.user?.profilePicture) {
                <img class="h-24 w-24 rounded-full object-cover mx-auto border-2 border-gray-100" 
                     [src]="candidate()!.user.profilePicture" 
                     [alt]="candidate()?.firstName + ' ' + candidate()?.lastName">
              } @else {
                <div class="h-24 w-24 rounded-full bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center text-white text-lg font-bold mx-auto border-2 border-gray-100">
                  {{ getInitials() }}
                </div>
              }
            </div>
            <h3 class="text-lg font-semibold text-gray-900 mb-1">
              {{ candidate()?.firstName }} {{ candidate()?.lastName }}
            </h3>
            <p class="text-sm text-gray-600 mb-4 truncate">{{ candidate()?.email }}</p>
            <div class="flex flex-col space-y-2 mb-4">
              <span class="inline-flex items-center justify-center px-3 py-1 rounded-full text-xs font-medium"
                    [ngClass]="candidate()?.user?.isActive ? 
                      'bg-green-100 text-green-800' : 
                      'bg-red-100 text-red-800'">
                {{ candidate()?.user?.isActive ? 'Active' : 'Inactive' }}
              </span>
              @if (candidate()?.isOpenToWork) {
                <span class="inline-flex items-center justify-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                  Open to Work
                </span>
              }
            </div>
            <!-- Social Links -->
            @if (candidate()?.linkedInUrl || candidate()?.githubUrl) {
              <div class="flex items-center justify-center space-x-3 pt-3 border-t border-gray-200">
                @if (candidate()?.linkedInUrl) {
                  <a [href]="candidate()!.linkedInUrl" target="_blank" 
                     class="text-gray-400 hover:text-blue-600 transition-colors p-1">
                    <app-icon name="linkedin" class="w-4 h-4"></app-icon>
                  </a>
                }
                @if (candidate()?.githubUrl) {
                  <a [href]="candidate()!.githubUrl" target="_blank" 
                     class="text-gray-400 hover:text-gray-600 transition-colors p-1">
                    <app-icon name="github" class="w-4 h-4"></app-icon>
                  </a>
                }
              </div>
            }
          </div>
        </app-card>

        <!-- Quick Stats -->
        <app-card class="mb-6">
          <div class="p-6">
            <h3 class="text-base font-semibold text-gray-900 mb-4">Quick Statistics</h3>
            <div class="space-y-3">
              <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <span class="text-xs font-medium text-gray-600">Applications</span>
                <span class="text-sm font-bold text-gray-900">
                  {{ candidate()?.applications?.length || 0 }}
                </span>
              </div>
              <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <span class="text-xs font-medium text-gray-600">Interviews</span>
                <span class="text-sm font-bold text-gray-900">
                  {{ candidate()?.interviews?.length || 0 }}
                </span>
              </div>
              <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <span class="text-xs font-medium text-gray-600">Visibility</span>
                <span class="text-xs font-medium"
                      [ngClass]="candidate()?.isProfilePublic ? 'text-green-600' : 'text-red-600'">
                  {{ candidate()?.isProfilePublic ? 'Public' : 'Private' }}
                </span>
              </div>
              <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <span class="text-xs font-medium text-gray-600">Member Since</span>
                <span class="text-xs font-medium text-gray-900">
                  {{ formatDate(candidate()?.createdAt) }}
                </span>
              </div>
            </div>
          </div>
        </app-card>

        <!-- Actions -->
        <app-card>
          <div class="p-6">
            <h3 class="text-base font-semibold text-gray-900 mb-4">Actions</h3>
            <div class="space-y-2">
              <app-button
                variant="primary"
                size="sm"
                (clicked)="scheduleInterview()"
                class="w-full justify-center text-xs py-2"
              >
                Schedule Interview
              </app-button>
              <app-button
                variant="outline"
                size="sm"
                (clicked)="sendMessage()"
                class="w-full justify-center text-xs py-2"
              >
                Send Message
              </app-button>
              <app-button
                variant="outline"
                size="sm"
                (clicked)="exportProfile()"
                class="w-full justify-center text-xs py-2"
              >
                Export Profile
              </app-button>
              <app-button
                variant="outline"
                size="sm"
                (clicked)="toggleCandidateStatus()"
                class="w-full justify-center text-xs py-2"
                [ngClass]="candidate()?.user?.isActive ? 'text-red-600 hover:text-red-700' : 'text-green-600 hover:text-green-700'"
              >
                {{ candidate()?.user?.isActive ? 'Deactivate' : 'Activate' }}
              </app-button>
            </div>
          </div>
        </app-card>
      </div>
    </div>
  }
</div>
